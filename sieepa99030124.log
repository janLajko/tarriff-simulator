INFO:sectionieepa_agent:Processing heading 9903.01.24
INFO:sectionieepa_agent:measure {
  "except": ["9903.01.21", "9903.01.22", "9903.01.23", "note2(w)"],
  "include": ["note2(u)"],
  "effective_period": {
    "start_date": null,
    "end_date": null
  },
  "country_iso2": null,
  "melt_pour_origin_iso2": null,
  "origin_exclude_iso2": [],
  "is_potential": false
}
INFO:sectionieepa_agent:Created measure 335 for heading 9903.01.24
INFO:sectionieepa_agent:Loaded 1 note rows for note(2)(u) (first path=['note', '2', 'u'])
INFO:sectionieepa_agent:note(2)(u) For the purposes of heading 9903.01.24, products of China and Hong Kong entered for consumption, or withdrawn from warehouse for consumption on or after 12:01 a.m., eastern standard time on March 4, 2025, other than products described in heading 9903.01.21, heading 9903.01.22, heading 9903.01.23, and other than products for personal use included in accompanied baggage of persons arriving in the United States, shall be subject to an additional 20% ad valorem rate of duty. Notwithstanding U.S. note 1 to this subchapter, all products of China and Hong Kong that are subject to the additional ad valorem (Compiler's Note: entered as written in notice) rate of duty imposed by heading 9903.01.24 shall also be subject to the general rates of duty imposed on products of China and Hong Kong entered under subheadings in chapters 1 to 97 of the tariff schedule. Products of China and Hong Kong that are eligible for temporary duty exemptions or reductions under subchapter II to chapter 99 shall be subject to the additional ad valorem rate of duty imposed by heading 9903.01.24. The additional duties imposed by heading 9903.01.24 shall not apply to goods for which entry is properly claimed under a provision of chapter 98 of the tariff schedule pursuant to applicable regulations of U.S. Customs and Border Protection ("CBP"), and whenever CBP agrees that entry under such a provision is appropriate, except for goods entered under heading 9802.00.80; and subheadings 9802.00.40, 9802.00.50, and 9802.00.60. For subheadings 9802.00.40, 9802.00.50, and 9802.00.60, the additional duties apply to the value of repairs, alterations, or processing performed (in China and Hong Kong), as described in the applicable subheading. For heading 9802.00.80, the additional duties apply to the value of the article assembled abroad (in China and Hong Kong), less the cost or value of such products of the United States, as described. Products of China and Hong Kong that are provided for in heading 9903.01.24 shall continue to be subject to antidumping, countervailing, or other duties, taxes, fees, exactions and charges that apply to such products, as well as to the additional ad valorem rate of duty imposed by heading 9903.01.24. Products of China and Hong Kong are not eligible for the administrative exemption from duty and certain taxes at 19 U.S.C. 1321(a)(2)(C)-known as ?? de minimis ?? exemption.
INFO:sectionieepa_agent:Querying LLM for notes note(2)(u)
INFO:sectionieepa_agent:message:You are a structured extractor for HTSUS Section ieepa notes.
Output JSON only. No inference. No paraphrasing. Include only codes that are explicitly printed in the input text.

Objective:
From the input legal note text, produce three outputs:
1. **input_htscode** – copy exactly from `context.input_htscode` (a list provided by the caller). Do NOT infer, paraphrase, or add/remove codes. If this field is missing, return an empty list.
2. **scope** – headings or subheadings that are explicitly stated to be covered (inside the range) by the measure. Do **not** include anything that appears only inside "except"/"exclusion" phrasing.
3. **except** – headings or subheadings explicitly excluded (phrases such as "except … provided for in …").

Each object in scope or except must match the `sieepa_scope` table schema:

- keys                 // comma-separated exact heading or HTS8 codes (e.g. "0203.29.20,0203.29.40,0206.10.00") when conditions are identical
- key                  // single exact heading or HTS8 code (e.g. "9903.88.05" or "8501.10.40") when used alone
- key_type             // one of: "heading" (use for 4-digit headings and any 6-digit references), "hts8" (8-digit subheading), "hts10" (10-digit statistical reporting number)
- country_iso2         // ISO-2 country code mentioned in the text (e.g. "UK"), else null
- source_label         // e.g. "note20(a)" or "note20(b)-exclusion"
- effective_start_date // ISO date; use context.fallback_start_date if not stated
- effective_end_date   // ISO date or null

Extraction rules:
A. Set **input_htscode** equal to `context.input_htscode`. Never invent or summarize values.

B. Identify all **scope** items:
   - Include every HTS reference that is explicitly printed (4-digit headings, 6-digit subheadings, 8-digit HTS codes, or 10-digit statistical reporting numbers) under "applies to…" or similar language.
   - When the text prints a range such as "9903.02.74-9903.02.77" or "9903.02.74–9903.02.77", expand it into each discrete heading (9903.02.74, 9903.02.75, 9903.02.76, 9903.02.77).
   - Do NOT include `input_htscode` again.
   - **When multiple HTS codes share identical conditions (same key_type, country_iso2, source_label, effective_start_date, effective_end_date), combine them using "keys" field with comma-separated values instead of creating separate objects.**

C. Identify all **except** items:
   - Look for any statement that exempts certain products/headings from the additional duties that would otherwise apply to `input_htscode`.
   - Common patterns include:
     * "Except as provided in heading(s) X..."
     * "The additional duties imposed by heading(s) [including input_htscode] shall not apply to [products] provided for in heading(s) X"
     * "As provided in heading X, the additional duties... shall not apply to products classified in..."
   
   - **Understanding Full vs Partial Exemptions:**
     * **FULL EXEMPTION** (add to `except`): The products classified in the referenced heading are COMPLETELY exempt from the additional duties.
       - The entire product/article in that heading is not subject to the additional duties.
       - Example: "The additional duties shall not apply to medium- and heavy-duty vehicle parts provided for in headings 9903.74.08 and 9903.74.09"
         → Products in 9903.74.08 and 9903.74.09 are FULLY exempt
     
     * **PARTIAL EXEMPTION** (do NOT add to `except`): Only a specific portion/component of the products in the referenced heading is exempt, while the remaining portion is still subject to duties.
       - The text clarifies that duties still apply to some part/content of the product.
       - Example: "The additional duties shall not apply to products of iron or steel provided for in headings 9903.81.87 and 9903.81.88, but such additional duties shall apply to the non-steel content of such products"
         → Products in 9903.81.87 and 9903.81.88 are only PARTIALLY exempt (steel content exempt, non-steel content still taxed)
       - Example: "The additional duties shall not apply to the declared value of the steel content of the derivative iron or steel products provided for in headings 9903.81.89-9903.81.93, but shall apply to the non-steel content"
         → Products in 9903.81.89-9903.81.93 are only PARTIALLY exempt
   
   - **Decision Rule**: 
     * Use your understanding of the legal language to determine: Are the products in the referenced heading COMPLETELY exempt from the additional duties, or are they only PARTIALLY exempt?
     * Only add headings to `except` if they represent FULL exemptions.
     * Do NOT add headings that represent partial exemptions (where some portion is still taxable).

   - Special handling for clauses like "As provided for in heading 9903.01.32, the additional duties imposed by headings 9903.01.25, 9903.01.35, 9903.01.39, 9903.01.63, and 9903.02.01-9903.02.73 shall not apply to products classified in the following subheadings …": the listed subheadings (e.g., 0201.10.05, 0201.10.10) are the contents of heading 9903.01.32. Add **9903.01.32** itself to the `except` set for each imposing heading (9903.01.25, 9903.01.35, 9903.01.39, 9903.01.63, 9903.02.01-9903.02.73). Do not add the enumerated subheadings directly to `except` in this scenario.
   
   - **Checking Applicability**: 
     * For an exemption to apply to `input_htscode`, the text must indicate that the exemption applies to the additional duties imposed by a list of headings that includes `input_htscode`.
     * Ranges like "9903.02.01-9903.02.73" include ALL codes numerically between start and end (inclusive).
     * Example: If input_htscode is "9903.02.02" and text says "duties imposed by headings 9903.02.01-9903.02.73 shall not apply to X", then X is an exemption for 9903.02.02.
   
   - Mark their source_label with "-exclusion".
   - Apply the same combination rule as scope items when conditions are identical.

D. Ignore carve-outs that clearly belong to other headings/programs (e.g., "As provided in 9903.01.26 ... products of Canada"). Unless the sentence explicitly ties the relief to `input_htscode`, do not add those references to `scope` or `except`.

E. Set country_iso2 to the ISO-2 code for the country named in the text (e.g. "UK" for "products of the United Kingdom"). If no country is mentioned, leave it null.

F. Only populate effective_start_date and effective_end_date when explicit "effective" or date ranges appear in the text.  
   - Example: "effective January 1, 2023" → effective_start_date = "2023-01-01"  
   - Example: "effective January 1, 2019 through December 31, 2019" → effective_start_date = "2019-01-01", effective_end_date = "2019-12-31"  
   - Entry/admission timing clauses (e.g., goods admitted to a foreign trade zone before 12:01 a.m. EDT on March 12, 2025) do **not** impose an effective_end_date; they only describe which entries qualify.  
   - If no explicit "effective" or date reference appears, leave both fields null. Do not use fallback_start_date.

G. Remove duplicates.

H. When multiple note blocks are provided, use `context.note_labels` (same order as the input blocks) for their labels. `context.primary_note_labels` lists the notes that actually triggered this extraction. `context.supporting_note_labels` lists subdivisions that were included only because a primary note referenced them (e.g., "subdivision (l)"). For supporting notes:
   - Treat any HTS codes printed inside those blocks as exclusions for the referencing primary note unless the supporting block clearly introduces a different heading of its own.
   - Use the primary note label with "-exclusion" for the `source_label` (e.g., `note16(m)-exclusion`).
   - Do NOT add supporting-block codes to the scope of the current heading unless the text explicitly says they apply to that heading.

I. If a supporting block explicitly states a different heading (e.g., "The rates … in heading 9903.81.89"), you may output its own scope entries but keep the source_label equal to that supporting note label.

Context (provided by caller):
// context.input_htscode → base headings provided by the caller; copy directly into "input_htscode"
// context.note_labels → labels for each input block (in order)
// context.primary_note_labels → subset that actually triggered extraction
// context.supporting_note_labels → subdivisions referenced only to describe exclusions for the primaries
{"country_iso2": null, "fallback_start_date": "1900-01-01", "input_htscode": ["9903.01.24"], "note_labels": ["note2(u)"], "primary_note_labels": ["note(2)(u)"], "source_label_prefix": "note(2)(u)", "supporting_note_labels": []}

Input (one or more note blocks, each beginning with its note label on the first line):
"""note2(u)
note(2)(u) For the purposes of heading 9903.01.24, products of China and Hong Kong entered for consumption, or withdrawn from warehouse for consumption on or after 12:01 a.m., eastern standard time on March 4, 2025, other than products described in heading 9903.01.21, heading 9903.01.22, heading 9903.01.23, and other than products for personal use included in accompanied baggage of persons arriving in the United States, shall be subject to an additional 20% ad valorem rate of duty. Notwithstanding U.S. note 1 to this subchapter, all products of China and Hong Kong that are subject to the additional ad valorem (Compiler's Note: entered as written in notice) rate of duty imposed by heading 9903.01.24 shall also be subject to the general rates of duty imposed on products of China and Hong Kong entered under subheadings in chapters 1 to 97 of the tariff schedule. Products of China and Hong Kong that are eligible for temporary duty exemptions or reductions under subchapter II to chapter 99 shall be subject to the additional ad valorem rate of duty imposed by heading 9903.01.24. The additional duties imposed by heading 9903.01.24 shall not apply to goods for which entry is properly claimed under a provision of chapter 98 of the tariff schedule pursuant to applicable regulations of U.S. Customs and Border Protection ("CBP"), and whenever CBP agrees that entry under such a provision is appropriate, except for goods entered under heading 9802.00.80; and subheadings 9802.00.40, 9802.00.50, and 9802.00.60. For subheadings 9802.00.40, 9802.00.50, and 9802.00.60, the additional duties apply to the value of repairs, alterations, or processing performed (in China and Hong Kong), as described in the applicable subheading. For heading 9802.00.80, the additional duties apply to the value of the article assembled abroad (in China and Hong Kong), less the cost or value of such products of the United States, as described. Products of China and Hong Kong that are provided for in heading 9903.01.24 shall continue to be subject to antidumping, countervailing, or other duties, taxes, fees, exactions and charges that apply to such products, as well as to the additional ad valorem rate of duty imposed by heading 9903.01.24. Products of China and Hong Kong are not eligible for the administrative exemption from duty and certain taxes at 19 U.S.C. 1321(a)(2)(C)-known as ?? de minimis ?? exemption."""

Output JSON format (note the use of "keys" for combined codes and "key" for single codes):
{
  "input_htscode": ["9903.88.01"],
  "scope": [
    { "keys": "0203.29.20,0203.29.40,0206.10.00,0208.10.00,0208.90.20,0208.90.25,0210.19.00", "key_type": "hts8", "country_iso2": "CN", "source_label": "note20(b)", "effective_start_date": "1900-01-01", "effective_end_date": null },
    { "key": "2845.30.00", "key_type": "hts8", "country_iso2": "CN", "source_label": "note20(b)", "effective_start_date": "1900-01-01", "effective_end_date": null }
  ],
  "except": [
    { "key": "9903.88.05", "key_type": "heading", "country_iso2": "CN", "source_label": "note20(a)-exclusion", "effective_start_date": "1900-01-01", "effective_end_date": null }
  ]
}

INFO:sectionieepa_agent:raw:{
  "input_htscode": ["9903.01.24"],
  "scope": [
    {
      "keys": "9802.00.80,9802.00.40,9802.00.50,9802.00.60",
      "key_type": "hts8",
      "country_iso2": "CN",
      "source_label": "note2(u)",
      "effective_start_date": "2025-03-04",
      "effective_end_date": null
    },
    {
      "keys": "9802.00.80,9802.00.40,9802.00.50,9802.00.60",
      "key_type": "hts8",
      "country_iso2": "HK",
      "source_label": "note2(u)",
      "effective_start_date": "2025-03-04",
      "effective_end_date": null
    }
  ],
  "except": [
    {
      "keys": "9903.01.21,9903.01.22,9903.01.23",
      "key_type": "heading",
      "country_iso2": "CN",
      "source_label": "note2(u)-exclusion",
      "effective_start_date": "2025-03-04",
      "effective_end_date": null
    },
    {
      "keys": "9903.01.21,9903.01.22,9903.01.23",
      "key_type": "heading",
      "country_iso2": "HK",
      "source_label": "note2(u)-exclusion",
      "effective_start_date": "2025-03-04",
      "effective_end_date": null
    }
  ]
}
INFO:sectionieepa_agent:Created scope 21911 for key 9802.00.80
INFO:sectionieepa_agent:Created scope 21912 for key 9802.00.40
INFO:sectionieepa_agent:Created scope 21913 for key 9802.00.50
INFO:sectionieepa_agent:Created scope 21914 for key 9802.00.60
INFO:sectionieepa_agent:Created scope 21915 for key 9802.00.80
INFO:sectionieepa_agent:Created scope 21916 for key 9802.00.40
INFO:sectionieepa_agent:Created scope 21917 for key 9802.00.50
INFO:sectionieepa_agent:Created scope 21918 for key 9802.00.60
INFO:sectionieepa_agent:Created scope↔measure relation 155983 (scope=21911, measure=335, include)
INFO:sectionieepa_agent:Created scope↔measure relation 155984 (scope=21912, measure=335, include)
INFO:sectionieepa_agent:Created scope↔measure relation 155985 (scope=21913, measure=335, include)
INFO:sectionieepa_agent:Created scope↔measure relation 155986 (scope=21914, measure=335, include)
INFO:sectionieepa_agent:Created scope↔measure relation 155987 (scope=21915, measure=335, include)
INFO:sectionieepa_agent:Created scope↔measure relation 155988 (scope=21916, measure=335, include)
INFO:sectionieepa_agent:Created scope↔measure relation 155989 (scope=21917, measure=335, include)
INFO:sectionieepa_agent:Created scope↔measure relation 155990 (scope=21918, measure=335, include)
INFO:sectionieepa_agent:Processing heading 9903.01.21
INFO:sectionieepa_agent:measure {
  "except": [],
  "include": ["note2(t)"],
  "effective_period": {
    "start_date": null,
    "end_date": null
  },
  "country_iso2": null,
  "melt_pour_origin_iso2": null,
  "origin_exclude_iso2": [],
  "is_potential": false
}
INFO:sectionieepa_agent:Created measure 336 for heading 9903.01.21
INFO:sectionieepa_agent:Loaded 1 note rows for note(2)(t) (first path=['note', '2', 't'])
INFO:sectionieepa_agent:note(2)(t) Heading 9903.01.21 covers only products of China and Hong Kong, that are donations, by persons subject to the jurisdiction of the United States, of articles, such as food, clothing, and medicine, intended to be used to relieve human suffering, except to the extent that the President determines that such donations (A) would seriously impair his ability to deal with any national emergency declared under section 1701 of title 19 of the U.S. Code, (B) are in response to coercion against the proposed recipient or donor, or (C) would endanger Armed Forces of the United States which are engaged in hostilities or are in a situation where imminent involvement in hostilities is clearly indicated by the circumstances.
INFO:sectionieepa_agent:Querying LLM for notes note(2)(t)
INFO:sectionieepa_agent:message:You are a structured extractor for HTSUS Section ieepa notes.
Output JSON only. No inference. No paraphrasing. Include only codes that are explicitly printed in the input text.

Objective:
From the input legal note text, produce three outputs:
1. **input_htscode** – copy exactly from `context.input_htscode` (a list provided by the caller). Do NOT infer, paraphrase, or add/remove codes. If this field is missing, return an empty list.
2. **scope** – headings or subheadings that are explicitly stated to be covered (inside the range) by the measure. Do **not** include anything that appears only inside "except"/"exclusion" phrasing.
3. **except** – headings or subheadings explicitly excluded (phrases such as "except … provided for in …").

Each object in scope or except must match the `sieepa_scope` table schema:

- keys                 // comma-separated exact heading or HTS8 codes (e.g. "0203.29.20,0203.29.40,0206.10.00") when conditions are identical
- key                  // single exact heading or HTS8 code (e.g. "9903.88.05" or "8501.10.40") when used alone
- key_type             // one of: "heading" (use for 4-digit headings and any 6-digit references), "hts8" (8-digit subheading), "hts10" (10-digit statistical reporting number)
- country_iso2         // ISO-2 country code mentioned in the text (e.g. "UK"), else null
- source_label         // e.g. "note20(a)" or "note20(b)-exclusion"
- effective_start_date // ISO date; use context.fallback_start_date if not stated
- effective_end_date   // ISO date or null

Extraction rules:
A. Set **input_htscode** equal to `context.input_htscode`. Never invent or summarize values.

B. Identify all **scope** items:
   - Include every HTS reference that is explicitly printed (4-digit headings, 6-digit subheadings, 8-digit HTS codes, or 10-digit statistical reporting numbers) under "applies to…" or similar language.
   - When the text prints a range such as "9903.02.74-9903.02.77" or "9903.02.74–9903.02.77", expand it into each discrete heading (9903.02.74, 9903.02.75, 9903.02.76, 9903.02.77).
   - Do NOT include `input_htscode` again.
   - **When multiple HTS codes share identical conditions (same key_type, country_iso2, source_label, effective_start_date, effective_end_date), combine them using "keys" field with comma-separated values instead of creating separate objects.**

C. Identify all **except** items:
   - Look for any statement that exempts certain products/headings from the additional duties that would otherwise apply to `input_htscode`.
   - Common patterns include:
     * "Except as provided in heading(s) X..."
     * "The additional duties imposed by heading(s) [including input_htscode] shall not apply to [products] provided for in heading(s) X"
     * "As provided in heading X, the additional duties... shall not apply to products classified in..."
   
   - **Understanding Full vs Partial Exemptions:**
     * **FULL EXEMPTION** (add to `except`): The products classified in the referenced heading are COMPLETELY exempt from the additional duties.
       - The entire product/article in that heading is not subject to the additional duties.
       - Example: "The additional duties shall not apply to medium- and heavy-duty vehicle parts provided for in headings 9903.74.08 and 9903.74.09"
         → Products in 9903.74.08 and 9903.74.09 are FULLY exempt
     
     * **PARTIAL EXEMPTION** (do NOT add to `except`): Only a specific portion/component of the products in the referenced heading is exempt, while the remaining portion is still subject to duties.
       - The text clarifies that duties still apply to some part/content of the product.
       - Example: "The additional duties shall not apply to products of iron or steel provided for in headings 9903.81.87 and 9903.81.88, but such additional duties shall apply to the non-steel content of such products"
         → Products in 9903.81.87 and 9903.81.88 are only PARTIALLY exempt (steel content exempt, non-steel content still taxed)
       - Example: "The additional duties shall not apply to the declared value of the steel content of the derivative iron or steel products provided for in headings 9903.81.89-9903.81.93, but shall apply to the non-steel content"
         → Products in 9903.81.89-9903.81.93 are only PARTIALLY exempt
   
   - **Decision Rule**: 
     * Use your understanding of the legal language to determine: Are the products in the referenced heading COMPLETELY exempt from the additional duties, or are they only PARTIALLY exempt?
     * Only add headings to `except` if they represent FULL exemptions.
     * Do NOT add headings that represent partial exemptions (where some portion is still taxable).

   - Special handling for clauses like "As provided for in heading 9903.01.32, the additional duties imposed by headings 9903.01.25, 9903.01.35, 9903.01.39, 9903.01.63, and 9903.02.01-9903.02.73 shall not apply to products classified in the following subheadings …": the listed subheadings (e.g., 0201.10.05, 0201.10.10) are the contents of heading 9903.01.32. Add **9903.01.32** itself to the `except` set for each imposing heading (9903.01.25, 9903.01.35, 9903.01.39, 9903.01.63, 9903.02.01-9903.02.73). Do not add the enumerated subheadings directly to `except` in this scenario.
   
   - **Checking Applicability**: 
     * For an exemption to apply to `input_htscode`, the text must indicate that the exemption applies to the additional duties imposed by a list of headings that includes `input_htscode`.
     * Ranges like "9903.02.01-9903.02.73" include ALL codes numerically between start and end (inclusive).
     * Example: If input_htscode is "9903.02.02" and text says "duties imposed by headings 9903.02.01-9903.02.73 shall not apply to X", then X is an exemption for 9903.02.02.
   
   - Mark their source_label with "-exclusion".
   - Apply the same combination rule as scope items when conditions are identical.

D. Ignore carve-outs that clearly belong to other headings/programs (e.g., "As provided in 9903.01.26 ... products of Canada"). Unless the sentence explicitly ties the relief to `input_htscode`, do not add those references to `scope` or `except`.

E. Set country_iso2 to the ISO-2 code for the country named in the text (e.g. "UK" for "products of the United Kingdom"). If no country is mentioned, leave it null.

F. Only populate effective_start_date and effective_end_date when explicit "effective" or date ranges appear in the text.  
   - Example: "effective January 1, 2023" → effective_start_date = "2023-01-01"  
   - Example: "effective January 1, 2019 through December 31, 2019" → effective_start_date = "2019-01-01", effective_end_date = "2019-12-31"  
   - Entry/admission timing clauses (e.g., goods admitted to a foreign trade zone before 12:01 a.m. EDT on March 12, 2025) do **not** impose an effective_end_date; they only describe which entries qualify.  
   - If no explicit "effective" or date reference appears, leave both fields null. Do not use fallback_start_date.

G. Remove duplicates.

H. When multiple note blocks are provided, use `context.note_labels` (same order as the input blocks) for their labels. `context.primary_note_labels` lists the notes that actually triggered this extraction. `context.supporting_note_labels` lists subdivisions that were included only because a primary note referenced them (e.g., "subdivision (l)"). For supporting notes:
   - Treat any HTS codes printed inside those blocks as exclusions for the referencing primary note unless the supporting block clearly introduces a different heading of its own.
   - Use the primary note label with "-exclusion" for the `source_label` (e.g., `note16(m)-exclusion`).
   - Do NOT add supporting-block codes to the scope of the current heading unless the text explicitly says they apply to that heading.

I. If a supporting block explicitly states a different heading (e.g., "The rates … in heading 9903.81.89"), you may output its own scope entries but keep the source_label equal to that supporting note label.

Context (provided by caller):
// context.input_htscode → base headings provided by the caller; copy directly into "input_htscode"
// context.note_labels → labels for each input block (in order)
// context.primary_note_labels → subset that actually triggered extraction
// context.supporting_note_labels → subdivisions referenced only to describe exclusions for the primaries
{"country_iso2": null, "fallback_start_date": "1900-01-01", "input_htscode": ["9903.01.21"], "note_labels": ["note2(t)"], "primary_note_labels": ["note(2)(t)"], "source_label_prefix": "note(2)(t)", "supporting_note_labels": []}

Input (one or more note blocks, each beginning with its note label on the first line):
"""note2(t)
note(2)(t) Heading 9903.01.21 covers only products of China and Hong Kong, that are donations, by persons subject to the jurisdiction of the United States, of articles, such as food, clothing, and medicine, intended to be used to relieve human suffering, except to the extent that the President determines that such donations (A) would seriously impair his ability to deal with any national emergency declared under section 1701 of title 19 of the U.S. Code, (B) are in response to coercion against the proposed recipient or donor, or (C) would endanger Armed Forces of the United States which are engaged in hostilities or are in a situation where imminent involvement in hostilities is clearly indicated by the circumstances."""

Output JSON format (note the use of "keys" for combined codes and "key" for single codes):
{
  "input_htscode": ["9903.88.01"],
  "scope": [
    { "keys": "0203.29.20,0203.29.40,0206.10.00,0208.10.00,0208.90.20,0208.90.25,0210.19.00", "key_type": "hts8", "country_iso2": "CN", "source_label": "note20(b)", "effective_start_date": "1900-01-01", "effective_end_date": null },
    { "key": "2845.30.00", "key_type": "hts8", "country_iso2": "CN", "source_label": "note20(b)", "effective_start_date": "1900-01-01", "effective_end_date": null }
  ],
  "except": [
    { "key": "9903.88.05", "key_type": "heading", "country_iso2": "CN", "source_label": "note20(a)-exclusion", "effective_start_date": "1900-01-01", "effective_end_date": null }
  ]
}

INFO:sectionieepa_agent:raw:{
  "input_htscode": ["9903.01.21"],
  "scope": [],
  "except": []
}
INFO:sectionieepa_agent:Created scope 21919 for key 9903.01.21
INFO:sectionieepa_agent:Created scope↔measure relation 155991 (scope=21919, measure=335, exclude)
INFO:sectionieepa_agent:Recorded child heading reference 9903.01.24 → 9903.01.21 as exclude
INFO:sectionieepa_agent:Processing heading 9903.01.22
INFO:sectionieepa_agent:measure {
  "except": [],
  "include": [],
  "effective_period": {
    "start_date": null,
    "end_date": null
  },
  "country_iso2": null,
  "melt_pour_origin_iso2": null,
  "origin_exclude_iso2": [],
  "is_potential": false
}
INFO:sectionieepa_agent:Created measure 337 for heading 9903.01.22
INFO:sectionieepa_agent:Created scope 21920 for key 9903.01.22
INFO:sectionieepa_agent:Created scope↔measure relation 155992 (scope=21920, measure=335, exclude)
INFO:sectionieepa_agent:Recorded child heading reference 9903.01.24 → 9903.01.22 as exclude
INFO:sectionieepa_agent:Processing heading 9903.01.23
INFO:sectionieepa_agent:measure {
  "except": ["9903.01.21", "9903.01.22"],
  "include": [],
  "effective_period": {"start_date": null, "end_date": null},
  "country_iso2": null,
  "melt_pour_origin_iso2": null,
  "origin_exclude_iso2": [],
  "is_potential": true
}
INFO:sectionieepa_agent:Created measure 338 for heading 9903.01.23
INFO:sectionieepa_agent:Created scope 21921 for key 9903.01.21
INFO:sectionieepa_agent:Created scope↔measure relation 155993 (scope=21921, measure=338, exclude)
INFO:sectionieepa_agent:Created scope 21922 for key 9903.01.22
INFO:sectionieepa_agent:Created scope↔measure relation 155994 (scope=21922, measure=338, exclude)
INFO:sectionieepa_agent:Created scope 21923 for key 9903.01.23
INFO:sectionieepa_agent:Created scope↔measure relation 155995 (scope=21923, measure=335, exclude)
INFO:sectionieepa_agent:Recorded child heading reference 9903.01.24 → 9903.01.23 as exclude
INFO:sectionieepa_agent:Created scope↔measure relation 155996 (scope=21919, measure=335, exclude)
INFO:sectionieepa_agent:Recorded child heading reference 9903.01.24 → 9903.01.21 as exclude
INFO:sectionieepa_agent:Created scope↔measure relation 155997 (scope=21920, measure=335, exclude)
INFO:sectionieepa_agent:Recorded child heading reference 9903.01.24 → 9903.01.22 as exclude
INFO:sectionieepa_agent:Created scope↔measure relation 155998 (scope=21923, measure=335, exclude)
INFO:sectionieepa_agent:Recorded child heading reference 9903.01.24 → 9903.01.23 as exclude
INFO:sectionieepa_agent:Loaded 1 note rows for note(2)(w) (first path=['note', '2', 'w'])
INFO:sectionieepa_agent:note(2)(w) Products of China and Hong Kong are not eligible for the administrative exemption from duty and certain taxes at 19 U.S.C.1321(a)(2)(C)-known as the ?? de minimis ?? exemption.
INFO:sectionieepa_agent:Querying LLM for notes note(2)(w)
INFO:sectionieepa_agent:message:You are a structured extractor for HTSUS Section ieepa notes.
Output JSON only. No inference. No paraphrasing. Include only codes that are explicitly printed in the input text.

Objective:
From the input legal note text, produce three outputs:
1. **input_htscode** – copy exactly from `context.input_htscode` (a list provided by the caller). Do NOT infer, paraphrase, or add/remove codes. If this field is missing, return an empty list.
2. **scope** – headings or subheadings that are explicitly stated to be covered (inside the range) by the measure. Do **not** include anything that appears only inside "except"/"exclusion" phrasing.
3. **except** – headings or subheadings explicitly excluded (phrases such as "except … provided for in …").

Each object in scope or except must match the `sieepa_scope` table schema:

- keys                 // comma-separated exact heading or HTS8 codes (e.g. "0203.29.20,0203.29.40,0206.10.00") when conditions are identical
- key                  // single exact heading or HTS8 code (e.g. "9903.88.05" or "8501.10.40") when used alone
- key_type             // one of: "heading" (use for 4-digit headings and any 6-digit references), "hts8" (8-digit subheading), "hts10" (10-digit statistical reporting number)
- country_iso2         // ISO-2 country code mentioned in the text (e.g. "UK"), else null
- source_label         // e.g. "note20(a)" or "note20(b)-exclusion"
- effective_start_date // ISO date; use context.fallback_start_date if not stated
- effective_end_date   // ISO date or null

Extraction rules:
A. Set **input_htscode** equal to `context.input_htscode`. Never invent or summarize values.

B. Identify all **scope** items:
   - Include every HTS reference that is explicitly printed (4-digit headings, 6-digit subheadings, 8-digit HTS codes, or 10-digit statistical reporting numbers) under "applies to…" or similar language.
   - When the text prints a range such as "9903.02.74-9903.02.77" or "9903.02.74–9903.02.77", expand it into each discrete heading (9903.02.74, 9903.02.75, 9903.02.76, 9903.02.77).
   - Do NOT include `input_htscode` again.
   - **When multiple HTS codes share identical conditions (same key_type, country_iso2, source_label, effective_start_date, effective_end_date), combine them using "keys" field with comma-separated values instead of creating separate objects.**

C. Identify all **except** items:
   - Look for any statement that exempts certain products/headings from the additional duties that would otherwise apply to `input_htscode`.
   - Common patterns include:
     * "Except as provided in heading(s) X..."
     * "The additional duties imposed by heading(s) [including input_htscode] shall not apply to [products] provided for in heading(s) X"
     * "As provided in heading X, the additional duties... shall not apply to products classified in..."
   
   - **Understanding Full vs Partial Exemptions:**
     * **FULL EXEMPTION** (add to `except`): The products classified in the referenced heading are COMPLETELY exempt from the additional duties.
       - The entire product/article in that heading is not subject to the additional duties.
       - Example: "The additional duties shall not apply to medium- and heavy-duty vehicle parts provided for in headings 9903.74.08 and 9903.74.09"
         → Products in 9903.74.08 and 9903.74.09 are FULLY exempt
     
     * **PARTIAL EXEMPTION** (do NOT add to `except`): Only a specific portion/component of the products in the referenced heading is exempt, while the remaining portion is still subject to duties.
       - The text clarifies that duties still apply to some part/content of the product.
       - Example: "The additional duties shall not apply to products of iron or steel provided for in headings 9903.81.87 and 9903.81.88, but such additional duties shall apply to the non-steel content of such products"
         → Products in 9903.81.87 and 9903.81.88 are only PARTIALLY exempt (steel content exempt, non-steel content still taxed)
       - Example: "The additional duties shall not apply to the declared value of the steel content of the derivative iron or steel products provided for in headings 9903.81.89-9903.81.93, but shall apply to the non-steel content"
         → Products in 9903.81.89-9903.81.93 are only PARTIALLY exempt
   
   - **Decision Rule**: 
     * Use your understanding of the legal language to determine: Are the products in the referenced heading COMPLETELY exempt from the additional duties, or are they only PARTIALLY exempt?
     * Only add headings to `except` if they represent FULL exemptions.
     * Do NOT add headings that represent partial exemptions (where some portion is still taxable).

   - Special handling for clauses like "As provided for in heading 9903.01.32, the additional duties imposed by headings 9903.01.25, 9903.01.35, 9903.01.39, 9903.01.63, and 9903.02.01-9903.02.73 shall not apply to products classified in the following subheadings …": the listed subheadings (e.g., 0201.10.05, 0201.10.10) are the contents of heading 9903.01.32. Add **9903.01.32** itself to the `except` set for each imposing heading (9903.01.25, 9903.01.35, 9903.01.39, 9903.01.63, 9903.02.01-9903.02.73). Do not add the enumerated subheadings directly to `except` in this scenario.
   
   - **Checking Applicability**: 
     * For an exemption to apply to `input_htscode`, the text must indicate that the exemption applies to the additional duties imposed by a list of headings that includes `input_htscode`.
     * Ranges like "9903.02.01-9903.02.73" include ALL codes numerically between start and end (inclusive).
     * Example: If input_htscode is "9903.02.02" and text says "duties imposed by headings 9903.02.01-9903.02.73 shall not apply to X", then X is an exemption for 9903.02.02.
   
   - Mark their source_label with "-exclusion".
   - Apply the same combination rule as scope items when conditions are identical.

D. Ignore carve-outs that clearly belong to other headings/programs (e.g., "As provided in 9903.01.26 ... products of Canada"). Unless the sentence explicitly ties the relief to `input_htscode`, do not add those references to `scope` or `except`.

E. Set country_iso2 to the ISO-2 code for the country named in the text (e.g. "UK" for "products of the United Kingdom"). If no country is mentioned, leave it null.

F. Only populate effective_start_date and effective_end_date when explicit "effective" or date ranges appear in the text.  
   - Example: "effective January 1, 2023" → effective_start_date = "2023-01-01"  
   - Example: "effective January 1, 2019 through December 31, 2019" → effective_start_date = "2019-01-01", effective_end_date = "2019-12-31"  
   - Entry/admission timing clauses (e.g., goods admitted to a foreign trade zone before 12:01 a.m. EDT on March 12, 2025) do **not** impose an effective_end_date; they only describe which entries qualify.  
   - If no explicit "effective" or date reference appears, leave both fields null. Do not use fallback_start_date.

G. Remove duplicates.

H. When multiple note blocks are provided, use `context.note_labels` (same order as the input blocks) for their labels. `context.primary_note_labels` lists the notes that actually triggered this extraction. `context.supporting_note_labels` lists subdivisions that were included only because a primary note referenced them (e.g., "subdivision (l)"). For supporting notes:
   - Treat any HTS codes printed inside those blocks as exclusions for the referencing primary note unless the supporting block clearly introduces a different heading of its own.
   - Use the primary note label with "-exclusion" for the `source_label` (e.g., `note16(m)-exclusion`).
   - Do NOT add supporting-block codes to the scope of the current heading unless the text explicitly says they apply to that heading.

I. If a supporting block explicitly states a different heading (e.g., "The rates … in heading 9903.81.89"), you may output its own scope entries but keep the source_label equal to that supporting note label.

Context (provided by caller):
// context.input_htscode → base headings provided by the caller; copy directly into "input_htscode"
// context.note_labels → labels for each input block (in order)
// context.primary_note_labels → subset that actually triggered extraction
// context.supporting_note_labels → subdivisions referenced only to describe exclusions for the primaries
{"country_iso2": null, "fallback_start_date": "1900-01-01", "input_htscode": ["9903.01.24"], "note_labels": ["note2(w)"], "primary_note_labels": ["note(2)(w)"], "source_label_prefix": "note(2)(w)", "supporting_note_labels": []}

Input (one or more note blocks, each beginning with its note label on the first line):
"""note2(w)
note(2)(w) Products of China and Hong Kong are not eligible for the administrative exemption from duty and certain taxes at 19 U.S.C.1321(a)(2)(C)-known as the ?? de minimis ?? exemption."""

Output JSON format (note the use of "keys" for combined codes and "key" for single codes):
{
  "input_htscode": ["9903.88.01"],
  "scope": [
    { "keys": "0203.29.20,0203.29.40,0206.10.00,0208.10.00,0208.90.20,0208.90.25,0210.19.00", "key_type": "hts8", "country_iso2": "CN", "source_label": "note20(b)", "effective_start_date": "1900-01-01", "effective_end_date": null },
    { "key": "2845.30.00", "key_type": "hts8", "country_iso2": "CN", "source_label": "note20(b)", "effective_start_date": "1900-01-01", "effective_end_date": null }
  ],
  "except": [
    { "key": "9903.88.05", "key_type": "heading", "country_iso2": "CN", "source_label": "note20(a)-exclusion", "effective_start_date": "1900-01-01", "effective_end_date": null }
  ]
}

INFO:sectionieepa_agent:raw:{
  "input_htscode": ["9903.01.24"],
  "scope": [],
  "except": []
}
INFO:sectionieepa_agent:Created scope↔measure relation 155999 (scope=21921, measure=335, exclude)
INFO:sectionieepa_agent:Created scope↔measure relation 156000 (scope=21922, measure=335, exclude)
INFO:sectionieepa_agent:Created scope 21924 for key 9903.01.23
INFO:sectionieepa_agent:Created scope↔measure relation 156001 (scope=21924, measure=335, exclude)
