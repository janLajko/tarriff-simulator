1、从当前数据库表hts_codes表中获取9903.88.01，9903.88.02，9903.88.03，9903.88.04，9903.88.15这几个301关税相关的hts信息
2、逐个解析9903.88.01，9903.88.02，9903.88.03，9903.88.04，9903.88.15
2.1 例如9903.88.01，从hts_codes查询hts数据，往s301_measures插入数据，作为measure_id，LLM分析从hts_codes表返回的description字段，
  You are a legal text structure analyzer. From the following text, extract:
  1. **Except sections**: all heading numbers listed after the phrase “Except as provided in headings”.
  2. **Include sections**: all notes or subheadings mentioned after phrases like “as provided for in” or “as provided for in the subheadings enumerated in”.
  3. **Effective period**: any date range describing when the rule is in effect, typically following phrases like “Effective with respect to entries on or after” or “through”.

  Input text:
  "Effective with respect to entries on or after June 15, 2024 and through November 29, 2025, articles the product of China, as provided for in U.S. note 20(vvv) to this subchapter, each covered by an exclusion granted by the U.S. Trade Representative."

  Output format:
  {
    "except": [],
    "include": ["20(vvv)"],
    "effective_period": {
      "start_date": "June 15, 2024",
      "end_date": "November 29, 2025"
    }
  }


2.2 分别解析except和include
2.2.1 解析的对象有两种情况
2.2.1.1 如果是 9903.88.05，表示是一个hts，首先需要在s301_measures表中检索是否已经存在，如果已经存在，则查询s301_scope中9903.88.05作为key的所有行，这里所有行可能会有include和exclude,保存在内存中，如果不存在，那么还需要去数据库中hts_codes查询它的description 和status,
如果status是expired，则代表过期数据，不需要处理，如果不是expired，采用2.1中对于hts description的prompt
例如 9903.88.69 
{
  "except": [],
  "include": ["note20(vvv)"],
  "effective_period": {
    "start_date": "June 15, 2024",
    "end_date": "November 29, 2025"
  }
}

2.2.1.2 如果是 ["note20(a)","note20(b)"] 表示需要解析note,那么就从hts_notes表中获取所有的notes,获取notes可以参考 @test_notes_agent.py get_note function,然后提交给LLM
这是prompt
You are a structured extractor for HTSUS Section 301 notes.
Output JSON only. No inference. No paraphrasing. Include only codes that are explicitly printed in the input text.

Objective:
From the input legal note text, produce three outputs:
1. **input_htscode** – the heading(s) that the note applies to (from phrases like “For the purposes of heading …”).
2. **scope** – all headings or HTS8 codes that fall under the effective scope of those input headings.
3. **except** – all headings or HTS8 codes explicitly excluded (“except … provided for in …”).

Each object in scope or except must match the `s301_scope` table schema:

- key                  // exact heading or HTS8 code, e.g. "9903.88.05" or "8501.10.40"
- key_type             // "heading" or "hts8" (never "note")
- country_iso2         // "CN" if “products of China” appears, else null
- source_label         // e.g. "note20(a)" or "note20(b)-exclusion"
- effective_start_date // ISO date; use context.fallback_start_date if not stated
- effective_end_date   // ISO date or null

Extraction rules:
A. Identify **input_htscode** from the leading clause “For the purposes of heading …”.
B. Identify all **scope** items:
   - For headings: include every 9903.xx.xx printed under “applies to…” or similar.
   - For HTS8: include every 8-digit subheading printed in the list.
   - Do NOT include `input_htscode` again.
C. Identify all **except** items:
   - Items explicitly listed after “except … provided for in …”.
   - Mark their source_label with “-exclusion”.
D. Use “CN” as country_iso2 if “products of China” is mentioned.
E. Use context.fallback_start_date for start_date if no effective period is found.
F. Remove duplicates.

Context (provided by caller):
{
  "country_iso2": "CN",
  "fallback_start_date": "1900-01-01",
  "source_label_prefix": ""
}

Input:
<PASTE NOTE TEXT HERE>

Output JSON format:
{
  "input_htscode": ["9903.88.01"],
  "scope": [
    { "key": "2845.20.00", "key_type": "hts8", "country_iso2": "CN", "source_label": "note20(b)", "effective_start_date": "1900-01-01", "effective_end_date": null },
    { "key": "2845.30.00", "key_type": "hts8", "country_iso2": "CN", "source_label": "note20(b)", "effective_start_date": "1900-01-01", "effective_end_date": null }
    /* … every printed HTS8 in the list … */
  ],
  "except": [
    { "key": "9903.88.05", "key_type": "heading", "country_iso2": "CN", "source_label": "note20(a)-exclusion", "effective_start_date": "1900-01-01", "effective_end_date": null },
    { "key": "9903.88.06", "key_type": "heading", "country_iso2": "CN", "source_label": "note20(a)-exclusion", "effective_start_date": "1900-01-01", "effective_end_date": null }
    /* … all other excluded headings … */
  ]
}

根据大模型的返回值把scope和except返回的记录插到s301_scope并维护s301_scope_measure_map表数据
特别需要注意的是如果scope和except中出现的key是99开头的，应该进一步解析，例如{ "key": "9903.88.05", "key_type": "heading", "country_iso2": "CN", "source_label": "note20(a)-exclusion", "effective_start_date": "1900-01-01", "effective_end_date": null }
则回到2.1对于hts的处理逻辑中