============================= test session starts ==============================
platform darwin -- Python 3.13.5, pytest-8.4.2, pluggy-1.6.0
rootdir: /Users/jan/Documents/7788/tariff-simulate-v2
plugins: anyio-4.11.0
collected 30 items

simulator/test/test_section301_rate.py 99038802_testcases.csv:2: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=True, amount=Decimal('0'), currency='USD', rate='25%', ch99_list=[Section301Ch99(ch99_id='9903.88.02', alias='9903.88.02', general_rate=Decimal('25.000'), ch99_description='Except as provided in headings 9903.88.12, 9903.88.17, 9903.88.20, 9903.88.54, 9903.88.59, 9903.88.61, 9903.88.63, 9903.88.66, 9903.88.67, 9903.88.68, 9903.88.69, or 9903.88.70, articles the product of China, as provided for in U.S. note 20(c) to this subchapter and as provided for in the subheadings enumerated in U.S. note 20(d)')], notes=['Applied Section 301 measures: 9903.88.02'])
.99038802_testcases.csv:3: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=True, amount=Decimal('0'), currency='USD', rate='25%', ch99_list=[Section301Ch99(ch99_id='9903.88.02', alias='9903.88.02', general_rate=Decimal('25.000'), ch99_description='Except as provided in headings 9903.88.12, 9903.88.17, 9903.88.20, 9903.88.54, 9903.88.59, 9903.88.61, 9903.88.63, 9903.88.66, 9903.88.67, 9903.88.68, 9903.88.69, or 9903.88.70, articles the product of China, as provided for in U.S. note 20(c) to this subchapter and as provided for in the subheadings enumerated in U.S. note 20(d)')], notes=['Applied Section 301 measures: 9903.88.02'])
.99038802_testcases.csv:4: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=True, amount=Decimal('0'), currency='USD', rate='25%', ch99_list=[Section301Ch99(ch99_id='9903.88.02', alias='9903.88.02', general_rate=Decimal('25.000'), ch99_description='Except as provided in headings 9903.88.12, 9903.88.17, 9903.88.20, 9903.88.54, 9903.88.59, 9903.88.61, 9903.88.63, 9903.88.66, 9903.88.67, 9903.88.68, 9903.88.69, or 9903.88.70, articles the product of China, as provided for in U.S. note 20(c) to this subchapter and as provided for in the subheadings enumerated in U.S. note 20(d)')], notes=['Applied Section 301 measures: 9903.88.02'])
.99038802_testcases.csv:5: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=True, amount=Decimal('0'), currency='USD', rate='25%', ch99_list=[Section301Ch99(ch99_id='9903.88.02', alias='9903.88.02', general_rate=Decimal('25.000'), ch99_description='Except as provided in headings 9903.88.12, 9903.88.17, 9903.88.20, 9903.88.54, 9903.88.59, 9903.88.61, 9903.88.63, 9903.88.66, 9903.88.67, 9903.88.68, 9903.88.69, or 9903.88.70, articles the product of China, as provided for in U.S. note 20(c) to this subchapter and as provided for in the subheadings enumerated in U.S. note 20(d)')], notes=['Applied Section 301 measures: 9903.88.02'])
.99038802_testcases.csv:6: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=True, amount=Decimal('0'), currency='USD', rate='25%', ch99_list=[Section301Ch99(ch99_id='9903.88.02', alias='9903.88.02', general_rate=Decimal('25.000'), ch99_description='Except as provided in headings 9903.88.12, 9903.88.17, 9903.88.20, 9903.88.54, 9903.88.59, 9903.88.61, 9903.88.63, 9903.88.66, 9903.88.67, 9903.88.68, 9903.88.69, or 9903.88.70, articles the product of China, as provided for in U.S. note 20(c) to this subchapter and as provided for in the subheadings enumerated in U.S. note 20(d)')], notes=['Applied Section 301 measures: 9903.88.02'])
.99038802_testcases.csv:7: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=True, amount=Decimal('0'), currency='USD', rate='25%', ch99_list=[Section301Ch99(ch99_id='9903.88.02', alias='9903.88.02', general_rate=Decimal('25.000'), ch99_description='Except as provided in headings 9903.88.12, 9903.88.17, 9903.88.20, 9903.88.54, 9903.88.59, 9903.88.61, 9903.88.63, 9903.88.66, 9903.88.67, 9903.88.68, 9903.88.69, or 9903.88.70, articles the product of China, as provided for in U.S. note 20(c) to this subchapter and as provided for in the subheadings enumerated in U.S. note 20(d)')], notes=['Applied Section 301 measures: 9903.88.02'])
.99038802_testcases.csv:8: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=True, amount=Decimal('0'), currency='USD', rate='25%', ch99_list=[Section301Ch99(ch99_id='9903.88.02', alias='9903.88.02', general_rate=Decimal('25.000'), ch99_description='Except as provided in headings 9903.88.12, 9903.88.17, 9903.88.20, 9903.88.54, 9903.88.59, 9903.88.61, 9903.88.63, 9903.88.66, 9903.88.67, 9903.88.68, 9903.88.69, or 9903.88.70, articles the product of China, as provided for in U.S. note 20(c) to this subchapter and as provided for in the subheadings enumerated in U.S. note 20(d)')], notes=['Applied Section 301 measures: 9903.88.02'])
.99038802_testcases.csv:9: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=True, amount=Decimal('0'), currency='USD', rate='25%', ch99_list=[Section301Ch99(ch99_id='9903.88.02', alias='9903.88.02', general_rate=Decimal('25.000'), ch99_description='Except as provided in headings 9903.88.12, 9903.88.17, 9903.88.20, 9903.88.54, 9903.88.59, 9903.88.61, 9903.88.63, 9903.88.66, 9903.88.67, 9903.88.68, 9903.88.69, or 9903.88.70, articles the product of China, as provided for in U.S. note 20(c) to this subchapter and as provided for in the subheadings enumerated in U.S. note 20(d)')], notes=['Applied Section 301 measures: 9903.88.02'])
.99038802_testcases.csv:10: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=True, amount=Decimal('0'), currency='USD', rate='25%', ch99_list=[Section301Ch99(ch99_id='9903.88.02', alias='9903.88.02', general_rate=Decimal('25.000'), ch99_description='Except as provided in headings 9903.88.12, 9903.88.17, 9903.88.20, 9903.88.54, 9903.88.59, 9903.88.61, 9903.88.63, 9903.88.66, 9903.88.67, 9903.88.68, 9903.88.69, or 9903.88.70, articles the product of China, as provided for in U.S. note 20(c) to this subchapter and as provided for in the subheadings enumerated in U.S. note 20(d)')], notes=['Applied Section 301 measures: 9903.88.02'])
.99038802_testcases.csv:11: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=True, amount=Decimal('0'), currency='USD', rate='25%', ch99_list=[Section301Ch99(ch99_id='9903.88.02', alias='9903.88.02', general_rate=Decimal('25.000'), ch99_description='Except as provided in headings 9903.88.12, 9903.88.17, 9903.88.20, 9903.88.54, 9903.88.59, 9903.88.61, 9903.88.63, 9903.88.66, 9903.88.67, 9903.88.68, 9903.88.69, or 9903.88.70, articles the product of China, as provided for in U.S. note 20(c) to this subchapter and as provided for in the subheadings enumerated in U.S. note 20(d)')], notes=['Applied Section 301 measures: 9903.88.02'])
.99038802_testcases.csv:12: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=False, amount=Decimal('0'), currency='USD', rate=None, ch99_list=[], notes=['No active Section 301 measures matched the provided HTS number on the given entry date.', 'Section 301 headings matched but have zero ad valorem rate: 9903.88.69.'])
.99038802_testcases.csv:13: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=False, amount=Decimal('0'), currency='USD', rate=None, ch99_list=[], notes=['No active Section 301 measures matched the provided HTS number on the given entry date.', 'Section 301 headings matched but have zero ad valorem rate: 9903.88.69.'])
.99038802_testcases.csv:14: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=False, amount=Decimal('0'), currency='USD', rate=None, ch99_list=[], notes=['No active Section 301 measures matched the provided HTS number on the given entry date.', 'Section 301 headings matched but have zero ad valorem rate: 9903.88.69.'])
.99038802_testcases.csv:15: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=False, amount=Decimal('0'), currency='USD', rate=None, ch99_list=[], notes=['No active Section 301 measures matched the provided HTS number on the given entry date.', 'Section 301 headings matched but have zero ad valorem rate: 9903.88.69.'])
.99038802_testcases.csv:16: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=False, amount=Decimal('0'), currency='USD', rate=None, ch99_list=[], notes=['No active Section 301 measures matched the provided HTS number on the given entry date.', 'Section 301 headings matched but have zero ad valorem rate: 9903.88.69.'])
.99038802_testcases.csv:17: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=False, amount=Decimal('0'), currency='USD', rate=None, ch99_list=[], notes=['No active Section 301 measures matched the provided HTS number on the given entry date.', 'Section 301 headings matched but have zero ad valorem rate: 9903.88.69.'])
.99038802_testcases.csv:18: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=False, amount=Decimal('0'), currency='USD', rate=None, ch99_list=[], notes=['No active Section 301 measures matched the provided HTS number on the given entry date.', 'Section 301 headings matched but have zero ad valorem rate: 9903.88.69.'])
.99038802_testcases.csv:19: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=False, amount=Decimal('0'), currency='USD', rate=None, ch99_list=[], notes=['No active Section 301 measures matched the provided HTS number on the given entry date.', 'Section 301 headings matched but have zero ad valorem rate: 9903.88.69.'])
.99038802_testcases.csv:20: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=False, amount=Decimal('0'), currency='USD', rate=None, ch99_list=[], notes=['No active Section 301 measures matched the provided HTS number on the given entry date.', 'Section 301 headings matched but have zero ad valorem rate: 9903.88.69.'])
.99038802_testcases.csv:21: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=False, amount=Decimal('0'), currency='USD', rate=None, ch99_list=[], notes=['No active Section 301 measures matched the provided HTS number on the given entry date.', 'Section 301 headings matched but have zero ad valorem rate: 9903.88.70.'])
.99038802_testcases.csv:22: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=True, amount=Decimal('0'), currency='USD', rate='25%', ch99_list=[Section301Ch99(ch99_id='9903.88.02', alias='9903.88.02', general_rate=Decimal('25.000'), ch99_description='Except as provided in headings 9903.88.12, 9903.88.17, 9903.88.20, 9903.88.54, 9903.88.59, 9903.88.61, 9903.88.63, 9903.88.66, 9903.88.67, 9903.88.68, 9903.88.69, or 9903.88.70, articles the product of China, as provided for in U.S. note 20(c) to this subchapter and as provided for in the subheadings enumerated in U.S. note 20(d)')], notes=['Applied Section 301 measures: 9903.88.02'])
.99038802_testcases.csv:23: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=False, amount=Decimal('0'), currency='USD', rate=None, ch99_list=[], notes=['No active Section 301 measures matched the provided HTS number on the given entry date.', 'Section 301 headings matched but have zero ad valorem rate: 9903.88.69.'])
.99038802_testcases.csv:24: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=True, amount=Decimal('0'), currency='USD', rate='25%', ch99_list=[Section301Ch99(ch99_id='9903.88.02', alias='9903.88.02', general_rate=Decimal('25.000'), ch99_description='Except as provided in headings 9903.88.12, 9903.88.17, 9903.88.20, 9903.88.54, 9903.88.59, 9903.88.61, 9903.88.63, 9903.88.66, 9903.88.67, 9903.88.68, 9903.88.69, or 9903.88.70, articles the product of China, as provided for in U.S. note 20(c) to this subchapter and as provided for in the subheadings enumerated in U.S. note 20(d)')], notes=['Applied Section 301 measures: 9903.88.02'])
.99038802_testcases.csv:25: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=True, amount=Decimal('0'), currency='USD', rate='25%', ch99_list=[Section301Ch99(ch99_id='9903.88.02', alias='9903.88.02', general_rate=Decimal('25.000'), ch99_description='Except as provided in headings 9903.88.12, 9903.88.17, 9903.88.20, 9903.88.54, 9903.88.59, 9903.88.61, 9903.88.63, 9903.88.66, 9903.88.67, 9903.88.68, 9903.88.69, or 9903.88.70, articles the product of China, as provided for in U.S. note 20(c) to this subchapter and as provided for in the subheadings enumerated in U.S. note 20(d)')], notes=['Applied Section 301 measures: 9903.88.02'])
.99038802_testcases.csv:26: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=False, amount=Decimal('0'), currency='USD', rate=None, ch99_list=[], notes=['No active Section 301 measures matched the provided HTS number on the given entry date.', 'Section 301 headings matched but have zero ad valorem rate: 9903.88.70.'])
.99038802_testcases.csv:27: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=True, amount=Decimal('0'), currency='USD', rate='25%', ch99_list=[Section301Ch99(ch99_id='9903.88.02', alias='9903.88.02', general_rate=Decimal('25.000'), ch99_description='Except as provided in headings 9903.88.12, 9903.88.17, 9903.88.20, 9903.88.54, 9903.88.59, 9903.88.61, 9903.88.63, 9903.88.66, 9903.88.67, 9903.88.68, 9903.88.69, or 9903.88.70, articles the product of China, as provided for in U.S. note 20(c) to this subchapter and as provided for in the subheadings enumerated in U.S. note 20(d)')], notes=['Applied Section 301 measures: 9903.88.02'])
.99038802_testcases.csv:28: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=False, amount=Decimal('0'), currency='USD', rate=None, ch99_list=[], notes=['No active Section 301 measures matched the provided HTS number on the given entry date.', 'Section 301 headings matched but have zero ad valorem rate: 9903.88.70.'])
F99038802_testcases.csv:29: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=False, amount=Decimal('0'), currency='USD', rate=None, ch99_list=[], notes=['No active Section 301 measures matched the provided HTS number on the given entry date.', 'Section 301 headings matched but have zero ad valorem rate: 9903.88.69.'])
F99038802_testcases.csv:30: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=False, amount=Decimal('0'), currency='USD', rate=None, ch99_list=[], notes=['No active Section 301 measures matched the provided HTS number on the given entry date.'])
F99038802_testcases.csv:31: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=False, amount=Decimal('0'), currency='USD', rate=None, ch99_list=[], notes=['Section 301 tariffs currently target products of China only.'])
.

=================================== FAILURES ===================================
___ test_compute_section301_duty_against_fixture[99038802_testcases.csv:28] ____

row_info = {'ambiguous': False, 'country': 'CN', 'duty': Decimal('25'), 'entry_date': datetime.date(2024, 4, 1), ...}

    @pytest.mark.parametrize("row_info", RAW_ROWS, ids=_fixture_id)
    def test_compute_section301_duty_against_fixture(row_info: dict):
        if row_info["ambiguous"]:
            pytest.skip(
                f"{row_info['id']} has multiple expected duty outcomes for identical inputs."
            )
    
        result = section301_rate.compute_section301_duty(
            row_info["input_hts"],
            row_info["country"],
            row_info["entry_date"],
        )
    
        print(f"{row_info['id']}: {result}")
    
        expected_duty = row_info["duty"]
        expected_heading = row_info["expected_heading"]
    
        if row_info["country"] != "CN" or expected_duty == 0:
            assert result.applicable is False, f"{row_info['id']}: expected no Section 301 duty"
            assert result.rate in (None, "0%"), f"{row_info['id']}: unexpected rate display"
            assert not result.ch99_list, f"{row_info['id']}: expected no CH99 entries"
            return
    
>       assert result.applicable is True, f"{row_info['id']}: expected duty to apply"
E       AssertionError: 99038802_testcases.csv:28: expected duty to apply
E       assert False is True
E        +  where False = Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=False, amount=Decimal('0'), curre...vided HTS number on the given entry date.', 'Section 301 headings matched but have zero ad valorem rate: 9903.88.70.']).applicable

simulator/test/test_section301_rate.py:119: AssertionError
___ test_compute_section301_duty_against_fixture[99038802_testcases.csv:29] ____

row_info = {'ambiguous': False, 'country': 'CN', 'duty': Decimal('25'), 'entry_date': datetime.date(2024, 7, 1), ...}

    @pytest.mark.parametrize("row_info", RAW_ROWS, ids=_fixture_id)
    def test_compute_section301_duty_against_fixture(row_info: dict):
        if row_info["ambiguous"]:
            pytest.skip(
                f"{row_info['id']} has multiple expected duty outcomes for identical inputs."
            )
    
        result = section301_rate.compute_section301_duty(
            row_info["input_hts"],
            row_info["country"],
            row_info["entry_date"],
        )
    
        print(f"{row_info['id']}: {result}")
    
        expected_duty = row_info["duty"]
        expected_heading = row_info["expected_heading"]
    
        if row_info["country"] != "CN" or expected_duty == 0:
            assert result.applicable is False, f"{row_info['id']}: expected no Section 301 duty"
            assert result.rate in (None, "0%"), f"{row_info['id']}: unexpected rate display"
            assert not result.ch99_list, f"{row_info['id']}: expected no CH99 entries"
            return
    
>       assert result.applicable is True, f"{row_info['id']}: expected duty to apply"
E       AssertionError: 99038802_testcases.csv:29: expected duty to apply
E       assert False is True
E        +  where False = Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=False, amount=Decimal('0'), curre...vided HTS number on the given entry date.', 'Section 301 headings matched but have zero ad valorem rate: 9903.88.69.']).applicable

simulator/test/test_section301_rate.py:119: AssertionError
___ test_compute_section301_duty_against_fixture[99038802_testcases.csv:30] ____

row_info = {'ambiguous': False, 'country': 'CN', 'duty': Decimal('25'), 'entry_date': datetime.date(2024, 8, 1), ...}

    @pytest.mark.parametrize("row_info", RAW_ROWS, ids=_fixture_id)
    def test_compute_section301_duty_against_fixture(row_info: dict):
        if row_info["ambiguous"]:
            pytest.skip(
                f"{row_info['id']} has multiple expected duty outcomes for identical inputs."
            )
    
        result = section301_rate.compute_section301_duty(
            row_info["input_hts"],
            row_info["country"],
            row_info["entry_date"],
        )
    
        print(f"{row_info['id']}: {result}")
    
        expected_duty = row_info["duty"]
        expected_heading = row_info["expected_heading"]
    
        if row_info["country"] != "CN" or expected_duty == 0:
            assert result.applicable is False, f"{row_info['id']}: expected no Section 301 duty"
            assert result.rate in (None, "0%"), f"{row_info['id']}: unexpected rate display"
            assert not result.ch99_list, f"{row_info['id']}: expected no CH99 entries"
            return
    
>       assert result.applicable is True, f"{row_info['id']}: expected duty to apply"
E       AssertionError: 99038802_testcases.csv:30: expected duty to apply
E       assert False is True
E        +  where False = Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=False, amount=Decimal('0'), curre...=None, ch99_list=[], notes=['No active Section 301 measures matched the provided HTS number on the given entry date.']).applicable

simulator/test/test_section301_rate.py:119: AssertionError
=========================== short test summary info ============================
FAILED simulator/test/test_section301_rate.py::test_compute_section301_duty_against_fixture[99038802_testcases.csv:28]
FAILED simulator/test/test_section301_rate.py::test_compute_section301_duty_against_fixture[99038802_testcases.csv:29]
FAILED simulator/test/test_section301_rate.py::test_compute_section301_duty_against_fixture[99038802_testcases.csv:30]
=================== 3 failed, 27 passed in 226.43s (0:03:46) ===================
