============================= test session starts ==============================
platform darwin -- Python 3.13.5, pytest-8.4.2, pluggy-1.6.0
rootdir: /Users/jan/Documents/7788/tariff-simulate-v2
plugins: anyio-4.11.0
collected 30 items

simulator/test/test_section301_rate.py 99038804_____30__.csv:2: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=True, amount=Decimal('0'), currency='USD', rate='25%', ch99_list=[Section301Ch99(ch99_id='9903.88.04', alias='9903.88.04', general_rate=Decimal('25.000'), ch99_description='Except as provided in headings 9903.88.33, 9903.88.34, 9903.88.36, 9903.88.37, 9903.88.38, 9903.88.40, 9903.88.46, 9903.88.48, 9903.88.56, 9903.88.64, 9903.88.66, 9903.88.67, or 9903.88.69, articles the product of China, as provided for in U.S. note 20(g) to this subchapter and as provided for in the subheadings enumerated in U.S. note 20(g)')], notes=['Applied Section 301 measures: 9903.88.04'])
.99038804_____30__.csv:3: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=True, amount=Decimal('0'), currency='USD', rate='32.5%', ch99_list=[Section301Ch99(ch99_id='9903.88.04', alias='9903.88.04', general_rate=Decimal('25.000'), ch99_description='Except as provided in headings 9903.88.33, 9903.88.34, 9903.88.36, 9903.88.37, 9903.88.38, 9903.88.40, 9903.88.46, 9903.88.48, 9903.88.56, 9903.88.64, 9903.88.66, 9903.88.67, or 9903.88.69, articles the product of China, as provided for in U.S. note 20(g) to this subchapter and as provided for in the subheadings enumerated in U.S. note 20(g)'), Section301Ch99(ch99_id='9903.88.15', alias='9903.88.15', general_rate=Decimal('7.500'), ch99_description='Except as provided in headings 9903.88.39, 9903.88.42, 9903.88.44, 9903.88.47, 9903.88.49, 9903.88.51, 9903.88.53, 9903.88.55, 9903.88.57, 9903.88.65, 9903.88.66, 9903.88.67, 9903.88.68, or 9903.88.69, articles the product of China, as provided for in U.S. note 20(r) to this subchapter and as provided for in the subheadings enumerated in U.S. note 20(s)')], notes=['Applied Section 301 measures: 9903.88.04, 9903.88.15'])
F99038804_____30__.csv:4: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=True, amount=Decimal('0'), currency='USD', rate='25%', ch99_list=[Section301Ch99(ch99_id='9903.88.04', alias='9903.88.04', general_rate=Decimal('25.000'), ch99_description='Except as provided in headings 9903.88.33, 9903.88.34, 9903.88.36, 9903.88.37, 9903.88.38, 9903.88.40, 9903.88.46, 9903.88.48, 9903.88.56, 9903.88.64, 9903.88.66, 9903.88.67, or 9903.88.69, articles the product of China, as provided for in U.S. note 20(g) to this subchapter and as provided for in the subheadings enumerated in U.S. note 20(g)')], notes=['Applied Section 301 measures: 9903.88.04'])
.99038804_____30__.csv:5: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=True, amount=Decimal('0'), currency='USD', rate='32.5%', ch99_list=[Section301Ch99(ch99_id='9903.88.04', alias='9903.88.04', general_rate=Decimal('25.000'), ch99_description='Except as provided in headings 9903.88.33, 9903.88.34, 9903.88.36, 9903.88.37, 9903.88.38, 9903.88.40, 9903.88.46, 9903.88.48, 9903.88.56, 9903.88.64, 9903.88.66, 9903.88.67, or 9903.88.69, articles the product of China, as provided for in U.S. note 20(g) to this subchapter and as provided for in the subheadings enumerated in U.S. note 20(g)'), Section301Ch99(ch99_id='9903.88.15', alias='9903.88.15', general_rate=Decimal('7.500'), ch99_description='Except as provided in headings 9903.88.39, 9903.88.42, 9903.88.44, 9903.88.47, 9903.88.49, 9903.88.51, 9903.88.53, 9903.88.55, 9903.88.57, 9903.88.65, 9903.88.66, 9903.88.67, 9903.88.68, or 9903.88.69, articles the product of China, as provided for in U.S. note 20(r) to this subchapter and as provided for in the subheadings enumerated in U.S. note 20(s)')], notes=['Applied Section 301 measures: 9903.88.04, 9903.88.15'])
F99038804_____30__.csv:6: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=True, amount=Decimal('0'), currency='USD', rate='32.5%', ch99_list=[Section301Ch99(ch99_id='9903.88.04', alias='9903.88.04', general_rate=Decimal('25.000'), ch99_description='Except as provided in headings 9903.88.33, 9903.88.34, 9903.88.36, 9903.88.37, 9903.88.38, 9903.88.40, 9903.88.46, 9903.88.48, 9903.88.56, 9903.88.64, 9903.88.66, 9903.88.67, or 9903.88.69, articles the product of China, as provided for in U.S. note 20(g) to this subchapter and as provided for in the subheadings enumerated in U.S. note 20(g)'), Section301Ch99(ch99_id='9903.88.15', alias='9903.88.15', general_rate=Decimal('7.500'), ch99_description='Except as provided in headings 9903.88.39, 9903.88.42, 9903.88.44, 9903.88.47, 9903.88.49, 9903.88.51, 9903.88.53, 9903.88.55, 9903.88.57, 9903.88.65, 9903.88.66, 9903.88.67, 9903.88.68, or 9903.88.69, articles the product of China, as provided for in U.S. note 20(r) to this subchapter and as provided for in the subheadings enumerated in U.S. note 20(s)')], notes=['Applied Section 301 measures: 9903.88.04, 9903.88.15'])
F99038804_____30__.csv:7: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=True, amount=Decimal('0'), currency='USD', rate='25%', ch99_list=[Section301Ch99(ch99_id='9903.88.04', alias='9903.88.04', general_rate=Decimal('25.000'), ch99_description='Except as provided in headings 9903.88.33, 9903.88.34, 9903.88.36, 9903.88.37, 9903.88.38, 9903.88.40, 9903.88.46, 9903.88.48, 9903.88.56, 9903.88.64, 9903.88.66, 9903.88.67, or 9903.88.69, articles the product of China, as provided for in U.S. note 20(g) to this subchapter and as provided for in the subheadings enumerated in U.S. note 20(g)')], notes=['Applied Section 301 measures: 9903.88.04'])
.99038804_____30__.csv:8: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=True, amount=Decimal('0'), currency='USD', rate='25%', ch99_list=[Section301Ch99(ch99_id='9903.88.04', alias='9903.88.04', general_rate=Decimal('25.000'), ch99_description='Except as provided in headings 9903.88.33, 9903.88.34, 9903.88.36, 9903.88.37, 9903.88.38, 9903.88.40, 9903.88.46, 9903.88.48, 9903.88.56, 9903.88.64, 9903.88.66, 9903.88.67, or 9903.88.69, articles the product of China, as provided for in U.S. note 20(g) to this subchapter and as provided for in the subheadings enumerated in U.S. note 20(g)')], notes=['Applied Section 301 measures: 9903.88.04'])
.99038804_____30__.csv:9: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=True, amount=Decimal('0'), currency='USD', rate='25%', ch99_list=[Section301Ch99(ch99_id='9903.88.04', alias='9903.88.04', general_rate=Decimal('25.000'), ch99_description='Except as provided in headings 9903.88.33, 9903.88.34, 9903.88.36, 9903.88.37, 9903.88.38, 9903.88.40, 9903.88.46, 9903.88.48, 9903.88.56, 9903.88.64, 9903.88.66, 9903.88.67, or 9903.88.69, articles the product of China, as provided for in U.S. note 20(g) to this subchapter and as provided for in the subheadings enumerated in U.S. note 20(g)')], notes=['Applied Section 301 measures: 9903.88.04'])
.99038804_____30__.csv:10: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=True, amount=Decimal('0'), currency='USD', rate='25%', ch99_list=[Section301Ch99(ch99_id='9903.88.04', alias='9903.88.04', general_rate=Decimal('25.000'), ch99_description='Except as provided in headings 9903.88.33, 9903.88.34, 9903.88.36, 9903.88.37, 9903.88.38, 9903.88.40, 9903.88.46, 9903.88.48, 9903.88.56, 9903.88.64, 9903.88.66, 9903.88.67, or 9903.88.69, articles the product of China, as provided for in U.S. note 20(g) to this subchapter and as provided for in the subheadings enumerated in U.S. note 20(g)')], notes=['Applied Section 301 measures: 9903.88.04'])
.99038804_____30__.csv:11: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=True, amount=Decimal('0'), currency='USD', rate='25%', ch99_list=[Section301Ch99(ch99_id='9903.88.04', alias='9903.88.04', general_rate=Decimal('25.000'), ch99_description='Except as provided in headings 9903.88.33, 9903.88.34, 9903.88.36, 9903.88.37, 9903.88.38, 9903.88.40, 9903.88.46, 9903.88.48, 9903.88.56, 9903.88.64, 9903.88.66, 9903.88.67, or 9903.88.69, articles the product of China, as provided for in U.S. note 20(g) to this subchapter and as provided for in the subheadings enumerated in U.S. note 20(g)')], notes=['Applied Section 301 measures: 9903.88.04'])
.99038804_____30__.csv:12: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=False, amount=Decimal('0'), currency='USD', rate=None, ch99_list=[], notes=['No active Section 301 measures matched the provided HTS number on the given entry date.', 'Section 301 headings matched but have zero ad valorem rate: 9903.88.69.'])
.99038804_____30__.csv:13: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=False, amount=Decimal('0'), currency='USD', rate=None, ch99_list=[], notes=['No active Section 301 measures matched the provided HTS number on the given entry date.', 'Section 301 headings matched but have zero ad valorem rate: 9903.88.69.'])
.99038804_____30__.csv:14: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=False, amount=Decimal('0'), currency='USD', rate=None, ch99_list=[], notes=['No active Section 301 measures matched the provided HTS number on the given entry date.', 'Section 301 headings matched but have zero ad valorem rate: 9903.88.69.'])
.99038804_____30__.csv:15: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=False, amount=Decimal('0'), currency='USD', rate=None, ch99_list=[], notes=['No active Section 301 measures matched the provided HTS number on the given entry date.', 'Section 301 headings matched but have zero ad valorem rate: 9903.88.69.'])
.99038804_____30__.csv:16: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=False, amount=Decimal('0'), currency='USD', rate=None, ch99_list=[], notes=['No active Section 301 measures matched the provided HTS number on the given entry date.', 'Section 301 headings matched but have zero ad valorem rate: 9903.88.69.'])
.99038804_____30__.csv:17: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=False, amount=Decimal('0'), currency='USD', rate=None, ch99_list=[], notes=['No active Section 301 measures matched the provided HTS number on the given entry date.', 'Section 301 headings matched but have zero ad valorem rate: 9903.88.69.'])
.99038804_____30__.csv:18: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=False, amount=Decimal('0'), currency='USD', rate=None, ch99_list=[], notes=['No active Section 301 measures matched the provided HTS number on the given entry date.', 'Section 301 headings matched but have zero ad valorem rate: 9903.88.69.'])
.99038804_____30__.csv:19: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=False, amount=Decimal('0'), currency='USD', rate=None, ch99_list=[], notes=['No active Section 301 measures matched the provided HTS number on the given entry date.', 'Section 301 headings matched but have zero ad valorem rate: 9903.88.69.'])
.99038804_____30__.csv:20: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=False, amount=Decimal('0'), currency='USD', rate=None, ch99_list=[], notes=['No active Section 301 measures matched the provided HTS number on the given entry date.', 'Section 301 headings matched but have zero ad valorem rate: 9903.88.69.'])
.99038804_____30__.csv:21: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=False, amount=Decimal('0'), currency='USD', rate=None, ch99_list=[], notes=['No active Section 301 measures matched the provided HTS number on the given entry date.', 'Section 301 headings matched but have zero ad valorem rate: 9903.88.69.'])
.99038804_____30__.csv:22: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=True, amount=Decimal('0'), currency='USD', rate='32.5%', ch99_list=[Section301Ch99(ch99_id='9903.88.04', alias='9903.88.04', general_rate=Decimal('25.000'), ch99_description='Except as provided in headings 9903.88.33, 9903.88.34, 9903.88.36, 9903.88.37, 9903.88.38, 9903.88.40, 9903.88.46, 9903.88.48, 9903.88.56, 9903.88.64, 9903.88.66, 9903.88.67, or 9903.88.69, articles the product of China, as provided for in U.S. note 20(g) to this subchapter and as provided for in the subheadings enumerated in U.S. note 20(g)'), Section301Ch99(ch99_id='9903.88.15', alias='9903.88.15', general_rate=Decimal('7.500'), ch99_description='Except as provided in headings 9903.88.39, 9903.88.42, 9903.88.44, 9903.88.47, 9903.88.49, 9903.88.51, 9903.88.53, 9903.88.55, 9903.88.57, 9903.88.65, 9903.88.66, 9903.88.67, 9903.88.68, or 9903.88.69, articles the product of China, as provided for in U.S. note 20(r) to this subchapter and as provided for in the subheadings enumerated in U.S. note 20(s)')], notes=['Applied Section 301 measures: 9903.88.04, 9903.88.15'])
F99038804_____30__.csv:23: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=False, amount=Decimal('0'), currency='USD', rate=None, ch99_list=[], notes=['No active Section 301 measures matched the provided HTS number on the given entry date.', 'Section 301 headings matched but have zero ad valorem rate: 9903.88.69.'])
.99038804_____30__.csv:24: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=False, amount=Decimal('0'), currency='USD', rate=None, ch99_list=[], notes=['No active Section 301 measures matched the provided HTS number on the given entry date.', 'Section 301 headings matched but have zero ad valorem rate: 9903.88.69.'])
.99038804_____30__.csv:25: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=True, amount=Decimal('0'), currency='USD', rate='32.5%', ch99_list=[Section301Ch99(ch99_id='9903.88.04', alias='9903.88.04', general_rate=Decimal('25.000'), ch99_description='Except as provided in headings 9903.88.33, 9903.88.34, 9903.88.36, 9903.88.37, 9903.88.38, 9903.88.40, 9903.88.46, 9903.88.48, 9903.88.56, 9903.88.64, 9903.88.66, 9903.88.67, or 9903.88.69, articles the product of China, as provided for in U.S. note 20(g) to this subchapter and as provided for in the subheadings enumerated in U.S. note 20(g)'), Section301Ch99(ch99_id='9903.88.15', alias='9903.88.15', general_rate=Decimal('7.500'), ch99_description='Except as provided in headings 9903.88.39, 9903.88.42, 9903.88.44, 9903.88.47, 9903.88.49, 9903.88.51, 9903.88.53, 9903.88.55, 9903.88.57, 9903.88.65, 9903.88.66, 9903.88.67, 9903.88.68, or 9903.88.69, articles the product of China, as provided for in U.S. note 20(r) to this subchapter and as provided for in the subheadings enumerated in U.S. note 20(s)')], notes=['Applied Section 301 measures: 9903.88.04, 9903.88.15'])
Fss99038804_____30__.csv:28: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=False, amount=Decimal('0'), currency='USD', rate=None, ch99_list=[], notes=['No active Section 301 measures matched the provided HTS number on the given entry date.'])
.99038804_____30__.csv:29: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=False, amount=Decimal('0'), currency='USD', rate=None, ch99_list=[], notes=['No active Section 301 measures matched the provided HTS number on the given entry date.'])
F99038804_____30__.csv:30: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=False, amount=Decimal('0'), currency='USD', rate=None, ch99_list=[], notes=['Section 301 tariffs currently target products of China only.'])
.99038804_____30__.csv:31: Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=True, amount=Decimal('0'), currency='USD', rate='32.5%', ch99_list=[Section301Ch99(ch99_id='9903.88.04', alias='9903.88.04', general_rate=Decimal('25.000'), ch99_description='Except as provided in headings 9903.88.33, 9903.88.34, 9903.88.36, 9903.88.37, 9903.88.38, 9903.88.40, 9903.88.46, 9903.88.48, 9903.88.56, 9903.88.64, 9903.88.66, 9903.88.67, or 9903.88.69, articles the product of China, as provided for in U.S. note 20(g) to this subchapter and as provided for in the subheadings enumerated in U.S. note 20(g)'), Section301Ch99(ch99_id='9903.88.15', alias='9903.88.15', general_rate=Decimal('7.500'), ch99_description='Except as provided in headings 9903.88.39, 9903.88.42, 9903.88.44, 9903.88.47, 9903.88.49, 9903.88.51, 9903.88.53, 9903.88.55, 9903.88.57, 9903.88.65, 9903.88.66, 9903.88.67, 9903.88.68, or 9903.88.69, articles the product of China, as provided for in U.S. note 20(r) to this subchapter and as provided for in the subheadings enumerated in U.S. note 20(s)')], notes=['Applied Section 301 measures: 9903.88.04, 9903.88.15'])
F

=================================== FAILURES ===================================
____ test_compute_section301_duty_against_fixture[99038804_____30__.csv:3] _____

row_info = {'ambiguous': False, 'country': 'CN', 'duty': Decimal('25'), 'entry_date': datetime.date(2024, 8, 1), ...}

    @pytest.mark.parametrize("row_info", RAW_ROWS, ids=_fixture_id)
    def test_compute_section301_duty_against_fixture(row_info: dict):
        if row_info["ambiguous"]:
            pytest.skip(
                f"{row_info['id']} has multiple expected duty outcomes for identical inputs."
            )
    
        result = section301_rate.compute_section301_duty(
            row_info["input_hts"],
            row_info["country"],
            row_info["entry_date"],
        )
    
        print(f"{row_info['id']}: {result}")
    
        expected_duty = row_info["duty"]
        expected_heading = row_info["expected_heading"]
    
        if row_info["country"] != "CN" or expected_duty == 0:
            assert result.applicable is False, f"{row_info['id']}: expected no Section 301 duty"
            assert result.rate in (None, "0%"), f"{row_info['id']}: unexpected rate display"
            assert not result.ch99_list, f"{row_info['id']}: expected no CH99 entries"
            return
    
        assert result.applicable is True, f"{row_info['id']}: expected duty to apply"
        assert result.ch99_list, f"{row_info['id']}: expected CH99 entries"
        assert any(
            ch.ch99_id == expected_heading for ch in result.ch99_list
        ), f"{row_info['id']}: missing expected CH99 heading {expected_heading}"
        assert result.rate is not None, f"{row_info['id']}: expected rate display"
        actual_rate = Decimal(result.rate.rstrip("%"))
>       assert actual_rate == expected_duty, f"{row_info['id']}: unexpected duty rate"
E       AssertionError: 99038804_____30__.csv:3: unexpected duty rate
E       assert Decimal('32.5') == Decimal('25')

simulator/test/test_section301_rate.py:126: AssertionError
____ test_compute_section301_duty_against_fixture[99038804_____30__.csv:5] _____

row_info = {'ambiguous': False, 'country': 'CN', 'duty': Decimal('25'), 'entry_date': datetime.date(2024, 10, 15), ...}

    @pytest.mark.parametrize("row_info", RAW_ROWS, ids=_fixture_id)
    def test_compute_section301_duty_against_fixture(row_info: dict):
        if row_info["ambiguous"]:
            pytest.skip(
                f"{row_info['id']} has multiple expected duty outcomes for identical inputs."
            )
    
        result = section301_rate.compute_section301_duty(
            row_info["input_hts"],
            row_info["country"],
            row_info["entry_date"],
        )
    
        print(f"{row_info['id']}: {result}")
    
        expected_duty = row_info["duty"]
        expected_heading = row_info["expected_heading"]
    
        if row_info["country"] != "CN" or expected_duty == 0:
            assert result.applicable is False, f"{row_info['id']}: expected no Section 301 duty"
            assert result.rate in (None, "0%"), f"{row_info['id']}: unexpected rate display"
            assert not result.ch99_list, f"{row_info['id']}: expected no CH99 entries"
            return
    
        assert result.applicable is True, f"{row_info['id']}: expected duty to apply"
        assert result.ch99_list, f"{row_info['id']}: expected CH99 entries"
        assert any(
            ch.ch99_id == expected_heading for ch in result.ch99_list
        ), f"{row_info['id']}: missing expected CH99 heading {expected_heading}"
        assert result.rate is not None, f"{row_info['id']}: expected rate display"
        actual_rate = Decimal(result.rate.rstrip("%"))
>       assert actual_rate == expected_duty, f"{row_info['id']}: unexpected duty rate"
E       AssertionError: 99038804_____30__.csv:5: unexpected duty rate
E       assert Decimal('32.5') == Decimal('25')

simulator/test/test_section301_rate.py:126: AssertionError
____ test_compute_section301_duty_against_fixture[99038804_____30__.csv:6] _____

row_info = {'ambiguous': False, 'country': 'CN', 'duty': Decimal('25'), 'entry_date': datetime.date(2024, 11, 10), ...}

    @pytest.mark.parametrize("row_info", RAW_ROWS, ids=_fixture_id)
    def test_compute_section301_duty_against_fixture(row_info: dict):
        if row_info["ambiguous"]:
            pytest.skip(
                f"{row_info['id']} has multiple expected duty outcomes for identical inputs."
            )
    
        result = section301_rate.compute_section301_duty(
            row_info["input_hts"],
            row_info["country"],
            row_info["entry_date"],
        )
    
        print(f"{row_info['id']}: {result}")
    
        expected_duty = row_info["duty"]
        expected_heading = row_info["expected_heading"]
    
        if row_info["country"] != "CN" or expected_duty == 0:
            assert result.applicable is False, f"{row_info['id']}: expected no Section 301 duty"
            assert result.rate in (None, "0%"), f"{row_info['id']}: unexpected rate display"
            assert not result.ch99_list, f"{row_info['id']}: expected no CH99 entries"
            return
    
        assert result.applicable is True, f"{row_info['id']}: expected duty to apply"
        assert result.ch99_list, f"{row_info['id']}: expected CH99 entries"
        assert any(
            ch.ch99_id == expected_heading for ch in result.ch99_list
        ), f"{row_info['id']}: missing expected CH99 heading {expected_heading}"
        assert result.rate is not None, f"{row_info['id']}: expected rate display"
        actual_rate = Decimal(result.rate.rstrip("%"))
>       assert actual_rate == expected_duty, f"{row_info['id']}: unexpected duty rate"
E       AssertionError: 99038804_____30__.csv:6: unexpected duty rate
E       assert Decimal('32.5') == Decimal('25')

simulator/test/test_section301_rate.py:126: AssertionError
____ test_compute_section301_duty_against_fixture[99038804_____30__.csv:22] ____

row_info = {'ambiguous': False, 'country': 'CN', 'duty': Decimal('25'), 'entry_date': datetime.date(2024, 6, 14), ...}

    @pytest.mark.parametrize("row_info", RAW_ROWS, ids=_fixture_id)
    def test_compute_section301_duty_against_fixture(row_info: dict):
        if row_info["ambiguous"]:
            pytest.skip(
                f"{row_info['id']} has multiple expected duty outcomes for identical inputs."
            )
    
        result = section301_rate.compute_section301_duty(
            row_info["input_hts"],
            row_info["country"],
            row_info["entry_date"],
        )
    
        print(f"{row_info['id']}: {result}")
    
        expected_duty = row_info["duty"]
        expected_heading = row_info["expected_heading"]
    
        if row_info["country"] != "CN" or expected_duty == 0:
            assert result.applicable is False, f"{row_info['id']}: expected no Section 301 duty"
            assert result.rate in (None, "0%"), f"{row_info['id']}: unexpected rate display"
            assert not result.ch99_list, f"{row_info['id']}: expected no CH99 entries"
            return
    
        assert result.applicable is True, f"{row_info['id']}: expected duty to apply"
        assert result.ch99_list, f"{row_info['id']}: expected CH99 entries"
        assert any(
            ch.ch99_id == expected_heading for ch in result.ch99_list
        ), f"{row_info['id']}: missing expected CH99 heading {expected_heading}"
        assert result.rate is not None, f"{row_info['id']}: expected rate display"
        actual_rate = Decimal(result.rate.rstrip("%"))
>       assert actual_rate == expected_duty, f"{row_info['id']}: unexpected duty rate"
E       AssertionError: 99038804_____30__.csv:22: unexpected duty rate
E       assert Decimal('32.5') == Decimal('25')

simulator/test/test_section301_rate.py:126: AssertionError
____ test_compute_section301_duty_against_fixture[99038804_____30__.csv:25] ____

row_info = {'ambiguous': False, 'country': 'CN', 'duty': Decimal('25'), 'entry_date': datetime.date(2025, 11, 30), ...}

    @pytest.mark.parametrize("row_info", RAW_ROWS, ids=_fixture_id)
    def test_compute_section301_duty_against_fixture(row_info: dict):
        if row_info["ambiguous"]:
            pytest.skip(
                f"{row_info['id']} has multiple expected duty outcomes for identical inputs."
            )
    
        result = section301_rate.compute_section301_duty(
            row_info["input_hts"],
            row_info["country"],
            row_info["entry_date"],
        )
    
        print(f"{row_info['id']}: {result}")
    
        expected_duty = row_info["duty"]
        expected_heading = row_info["expected_heading"]
    
        if row_info["country"] != "CN" or expected_duty == 0:
            assert result.applicable is False, f"{row_info['id']}: expected no Section 301 duty"
            assert result.rate in (None, "0%"), f"{row_info['id']}: unexpected rate display"
            assert not result.ch99_list, f"{row_info['id']}: expected no CH99 entries"
            return
    
        assert result.applicable is True, f"{row_info['id']}: expected duty to apply"
        assert result.ch99_list, f"{row_info['id']}: expected CH99 entries"
        assert any(
            ch.ch99_id == expected_heading for ch in result.ch99_list
        ), f"{row_info['id']}: missing expected CH99 heading {expected_heading}"
        assert result.rate is not None, f"{row_info['id']}: expected rate display"
        actual_rate = Decimal(result.rate.rstrip("%"))
>       assert actual_rate == expected_duty, f"{row_info['id']}: unexpected duty rate"
E       AssertionError: 99038804_____30__.csv:25: unexpected duty rate
E       assert Decimal('32.5') == Decimal('25')

simulator/test/test_section301_rate.py:126: AssertionError
____ test_compute_section301_duty_against_fixture[99038804_____30__.csv:29] ____

row_info = {'ambiguous': False, 'country': 'CN', 'duty': Decimal('25'), 'entry_date': datetime.date(2024, 7, 1), ...}

    @pytest.mark.parametrize("row_info", RAW_ROWS, ids=_fixture_id)
    def test_compute_section301_duty_against_fixture(row_info: dict):
        if row_info["ambiguous"]:
            pytest.skip(
                f"{row_info['id']} has multiple expected duty outcomes for identical inputs."
            )
    
        result = section301_rate.compute_section301_duty(
            row_info["input_hts"],
            row_info["country"],
            row_info["entry_date"],
        )
    
        print(f"{row_info['id']}: {result}")
    
        expected_duty = row_info["duty"]
        expected_heading = row_info["expected_heading"]
    
        if row_info["country"] != "CN" or expected_duty == 0:
            assert result.applicable is False, f"{row_info['id']}: expected no Section 301 duty"
            assert result.rate in (None, "0%"), f"{row_info['id']}: unexpected rate display"
            assert not result.ch99_list, f"{row_info['id']}: expected no CH99 entries"
            return
    
>       assert result.applicable is True, f"{row_info['id']}: expected duty to apply"
E       AssertionError: 99038804_____30__.csv:29: expected duty to apply
E       assert False is True
E        +  where False = Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=False, amount=Decimal('0'), curre...=None, ch99_list=[], notes=['No active Section 301 measures matched the provided HTS number on the given entry date.']).applicable

simulator/test/test_section301_rate.py:119: AssertionError
____ test_compute_section301_duty_against_fixture[99038804_____30__.csv:31] ____

row_info = {'ambiguous': False, 'country': 'CN', 'duty': Decimal('0'), 'entry_date': datetime.date(2024, 7, 20), ...}

    @pytest.mark.parametrize("row_info", RAW_ROWS, ids=_fixture_id)
    def test_compute_section301_duty_against_fixture(row_info: dict):
        if row_info["ambiguous"]:
            pytest.skip(
                f"{row_info['id']} has multiple expected duty outcomes for identical inputs."
            )
    
        result = section301_rate.compute_section301_duty(
            row_info["input_hts"],
            row_info["country"],
            row_info["entry_date"],
        )
    
        print(f"{row_info['id']}: {result}")
    
        expected_duty = row_info["duty"]
        expected_heading = row_info["expected_heading"]
    
        if row_info["country"] != "CN" or expected_duty == 0:
>           assert result.applicable is False, f"{row_info['id']}: expected no Section 301 duty"
E           AssertionError: 99038804_____30__.csv:31: expected no Section 301 duty
E           assert True is False
E            +  where True = Section301Computation(module_id='301', module_name='Section 301 Tariffs', applicable=True, amount=Decimal('0'), curren...or in the subheadings enumerated in U.S. note 20(s)')], notes=['Applied Section 301 measures: 9903.88.04, 9903.88.15']).applicable

simulator/test/test_section301_rate.py:114: AssertionError
=========================== short test summary info ============================
FAILED simulator/test/test_section301_rate.py::test_compute_section301_duty_against_fixture[99038804_____30__.csv:3]
FAILED simulator/test/test_section301_rate.py::test_compute_section301_duty_against_fixture[99038804_____30__.csv:5]
FAILED simulator/test/test_section301_rate.py::test_compute_section301_duty_against_fixture[99038804_____30__.csv:6]
FAILED simulator/test/test_section301_rate.py::test_compute_section301_duty_against_fixture[99038804_____30__.csv:22]
FAILED simulator/test/test_section301_rate.py::test_compute_section301_duty_against_fixture[99038804_____30__.csv:25]
FAILED simulator/test/test_section301_rate.py::test_compute_section301_duty_against_fixture[99038804_____30__.csv:29]
FAILED simulator/test/test_section301_rate.py::test_compute_section301_duty_against_fixture[99038804_____30__.csv:31]
============= 7 failed, 21 passed, 2 skipped in 233.21s (0:03:53) ==============
